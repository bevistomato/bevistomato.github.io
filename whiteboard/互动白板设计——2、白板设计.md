# 白板的界面元素


![whiteboard](whiteboard-0.png)

如上图可以简单推测，白板主要由多个View嵌套而成，他们分别是：

控件 | 类型 | Parent | 功能
---- | --- | ------ | -----------------------------------------------
 board | Grid  | null | 白板的外边框, 内部设定为黑色
 sv2 | ScrollViewer | board | 通过它让白板可以自适应不同尺寸的屏幕
 ink_tool | InkToolBar | board | 书写工具，可以更改笔迹颜色和粗细
 sv | ScrollViewer | sv2 | 实现白板的缩放和左右滑动
 working_area  | Grid | sv | 表示白板的真正做图区域, 设定区域的最大长宽，避免网络传输时数据溢出，内部设定为黑色
 paper_layer | Image | working_area | 显示讲义
 writing_layer | InkCanvas | working_area | 用户书写层
 ink_layer | InkCanvas | working_area | 用户笔迹显示层，将所有用户的笔迹汇总后显示
 
 
## 界面初始化


```csharp

 protected RET_MSG initLayout(Grid div)
 {
     // 设置白板外框滚动条
     ScrollViewer sv = new ScrollViewer();
     sv.Margin = new Thickness(0, 0, 0, 0); 
     // 不显示滚动条
     sv.VerticalScrollBarVisibility = ScrollBarVisibility.Hidden;
     sv.HorizontalScrollBarVisibility = ScrollBarVisibility.Hidden;
     // 允许通过双指在屏幕上操作缩放
     sv.ZoomMode = ZoomMode.Enabled;
     // 允许白板跟随手指滑动
     sv.VerticalScrollMode = ScrollMode.Auto;
     sv.HorizontalScrollMode = ScrollMode.Auto;
     // 讲义以外的区域显示黑色
     sv.Background = new SolidColorBrush(Colors.Black);
     // 缩放最大最小范围
     sv.MaxZoomFactor = MAX_ZOOM_FACTOR;
     sv.MinZoomFactor = MIN_ZOOM_FACTOR;
     sv.Width = LAYOUT_SCROLL_WIDTH;
     sv.Height = LAYOUT_SCROLL_WIDTH / LAYOUT_WIDTH_PER_HEIGHT;
     sv.IsZoomChainingEnabled = false;
     sv.IsVerticalScrollChainingEnabled = false;
     sv.IsHorizontalScrollChainingEnabled = false;
     _sv = sv;

     // 设置界面缩放，缩放外层滚动条
     // 从而使得内层坐标范围和PC分别率无关
     ScrollViewer sv2 = new ScrollViewer();
     sv2.Margin = new Thickness(0, 0, 0, 0);
     sv2.VerticalScrollBarVisibility = ScrollBarVisibility.Hidden;
     sv2.HorizontalScrollBarVisibility = ScrollBarVisibility.Hidden;
     // 不允许用户缩放
     sv2.ZoomMode = ZoomMode.Disabled;
     sv2.VerticalScrollMode = ScrollMode.Disabled;
     sv2.HorizontalScrollMode = ScrollMode.Disabled;
     sv2.Background = new SolidColorBrush(Colors.Black);
     sv2.MaxZoomFactor = MAX_ZOOM_FACTOR;
     sv2.MinZoomFactor = MIN_ZOOM_FACTOR;

     sv2.IsZoomChainingEnabled = false;
     sv2.IsVerticalScrollChainingEnabled = false;
     sv2.IsHorizontalScrollChainingEnabled = false;
     _hidden_sv = sv2;
     sv2.Content = sv;


     // 设置讲义层
     _paper_layer = new Image();
     
     // 设定最大宽高，避免网络传输溢出
     _paper_layer.MaxWidth = MAX_PAPER_WIDTH;
     _paper_layer.MaxHeight = MAX_PAPER_HEIGHT;
     _paper_layer.Width = MAX_PAPER_WIDTH;
     _paper_layer.Height = MAX_PAPER_HEIGHT;
     _paper_layer.VerticalAlignment = VerticalAlignment.Center;
     _paper_layer.HorizontalAlignment = HorizontalAlignment.Center;
     _paper_layer.Stretch = Stretch.Uniform;
     _paper_layer.Source = null;





     // 设置手写板的控件
     InkToolbar bar = new InkToolbar();

     // 设置墨迹显示层
     _ink_layer = new InkCanvas();
     _ink_layer.InkPresenter.InputDeviceTypes = Windows.UI.Core.CoreInputDeviceTypes.None;
     _ink_layer.InkPresenter.IsInputEnabled = false;


     // 设置笔迹书写层
     _write_layer = new InkCanvas();
     // 初始化笔迹层
     _write_layer.InkPresenter.InputDeviceTypes = Windows.UI.Core.CoreInputDeviceTypes.Pen;
     _ink_sync = _write_layer.InkPresenter.ActivateCustomDrying();


     // 初始化手写板控件
     bar.TargetInkCanvas = _write_layer;
     bar.Height = 45;
     bar.HorizontalAlignment = HorizontalAlignment.Left;
     bar.VerticalAlignment = VerticalAlignment.Top;


     bar.Children.Add(new InkToolbarHighlighterButton());
     bar.Children.Add(new InkToolbarBallpointPenButton());
     bar.Children.Add(new InkToolbarEraserButton());

     bar.InitialControls = InkToolbarInitialControls.None;
     bar.RequestedTheme = ElementTheme.Light;
     _ink_tool = bar;





     // 将工作区域设置成白色
     Grid working_area = new Grid();
     working_area.Width = MAX_PAPER_WIDTH;
     working_area.Height = MAX_PAPER_HEIGHT;
     working_area.Background = new SolidColorBrush(Colors.Black);
     // 将背景和手写屏加入工作区域

     working_area.Children.Add(_paper_layer);
     working_area.Children.Add(_ink_layer);
     working_area.Children.Add(_write_layer);

     _working_area = working_area;


     // 将工作区域放入非工作区域
     sv.Content = working_area;



     // 将非工作区域放入界面
     _board = div;
     _board.Children.Add(sv2);
     _board.Children.Add(bar);
     _board.Background = new SolidColorBrush(Colors.Black);

     // 强制刷新界面元素
     _board.UpdateLayout();
     // 根据APP宽高，调整sv2的宽高
     resizeScrollView();
     // 根据sv2的宽高和sv的宽高，将sv缩放至和sv2大小一致
     _board.UpdateLayout();
     rezoomScrollView();

     // 设置页面初始显示宽度等于界面宽度
     double svw = _sv.ViewportWidth;
     _sv.ChangeView(0, 0, (float)(svw / MAX_PAPER_WIDTH));
     _board.UpdateLayout();

     return RET_MSG.ERR_OK;
 }


```



# 白板的

## 演讲模式

### 老师端功能设定

进入该模式的时候：

1、 需要告诉所有的学生，目前已经进入演讲模式。

2、 发送指令，统一让学生的白板界面显示与老师显示一致。

### 学生端功能设定

收到进入演讲模式的指令：

1、 禁用学生端的写，缩放，翻页等等操作。

2、 同步显示老师当前界面

## 自由模式

### 老师端功能设定

进入该模式的时候：

1、 需要告诉所有的学生，目前已经进入自由模式。

### 学生端功能设定

收到进入自由模式的指令：

1、 将白板切回到学生自己的内容，保持讲义页码不变，白板变成学生的。

2、 启用学生端的写，缩放，翻页等等操作。

